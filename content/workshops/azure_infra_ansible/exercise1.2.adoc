---
title: "Exercise 1.2 - Running Your Playbook"
workshops: azure_infra_ansible
workshop_weight: 12
layout: lab
---

:icons: font
:imagesdir: /workshops/azure_infra_ansible/images
:package_url: http://docs.ansible.com/ansible/package_module.html
:service_url: http://docs.ansible.com/ansible/service_module.html
:gather_facts_url: http://docs.ansible.com/ansible/latest/playbooks_variables.html#turning-off-facts


= Exercise 1.2 - Running Your Playbook


== Section 1: Running the Playbook


We are now going to run your brand spankin' new playbook on your Azure host.  To do this,
 you are going to use the `ansible-playbook` command.

=== Step 1: Run your playbook

From your playbook directory ( `~/azure_infra` ), run your playbook.

[source,bash]
----
ansible-playbook -i ../hosts create_azure_infra.yml
----


However, before you run that command, lets take a few moments to understand the options.

- *-i* This option allows you to specify the inventory file you wish to use.
- *-v* Altough not used here, this increases verbosity.  Try running your playbook a second time using `-v` or `-vv` to increase the verbosity


[NOTE]
- *--syntax-check* If you run into any issues with your playbook running properly; you know, from that copy/pasting that you didn't do because we said "_don't do that_"; you could use this option to help find those issues like so...

[source,bash]
----
ansible-playbook -i ../hosts create_azure_infra.yml --syntax-check
----


---
Now, run your playbook as specified in *Step 1*

In standard output, you should see something that looks very similar to the following:

image::stdout_1.png[caption="Figure 1: ", title="azure_infra playbook stdout",228]

Notice that the play and each task is named, so that you can understand the action being performed and the node it is being performed upon.

Once the play completes. Log into your Azure portal and click *All resources* to view the Virtaul Network that you just created.

image::azure_network.png[caption="Figure 2: ", title="Azure Resources"]

== Section 2: Building out your Infrastructure

Now that we have a Virtaul Network,  lets build out the reset of our infrastructure so support a virtual machine. To do this we are going to be adding
tasks to our original playbook.

=== Step 1: Create a public IP address

The first thing we will be doing is adding a Public IP address to the machine so we can connect to it once it is up and running.

[source,bash]
----
tasks:
 - name: Create Azure Network
   azure_rm_virtualnetwork:
     name: {{< urifqdn_azure_login "Student" "-Network" >}}
     address_prefixes_cidr: 172.16.0.0/16
     resource_group: {{< urifqdn_azure_login "Student" >}}

 - name: Create a public ip address
   azure_rm_publicipaddress:
     resource_group: {{< urifqdn_azure_login "Student" >}}
     name: {{< urifqdn_azure_login "Student" "-PubIP" >}}
     allocation_method: Dynamic
     domain_name: {{< urifqdn_azure_login "Student" "-VM1" >}}
----

{{< importPartial "footer/footer_azure.html" >}}
