---
title: "Exercise 1.0 - Azure CLI"
workshops: azure_infra_ansible
workshop_weight: 10
layout: lab
---

:dir_url: https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest
:azure_portal_url: portal.azure.com
:domain_name: redhatgov.io
:icons: font
:imagesdir: /workshops/azure_infra_ansible/images


= Exercise 1.0 - Logging into Azure CLI


== Section 1: Azure CLI

For our first exercise, we are going to log into Azure CLI. This is the way we will be connecting to the Azure infrastructure to run our Ansible Automation.

=== Set Up Dependencies:

Azure CLI has already been installed for you. For more information on how it is installed please see link:{dir_url}[Install the Azure CLI].

=== Step 1: Log into Azure CLI

Let's start with something basic - logging into the Azure CLI

[source,bash]
----
az login
----

Once that command is run, it will return a URL and and authorization code. Please bring up a second browser tab and enter that URL and Authorization code.

image::az_login.PNG[caption="Figure 1: ", title="az login stdout"]

Once everything is entered please press continue. It will then bring you to the login page.

image::azure_sign_in.PNG[catpion="Figure 2: ", title="Azure Sign in"]

To Sign in please use the below credentials

[source,bash]
----
Email: {{< urifqdn_azure_login "Student" "@snxcsp.onmicrosoft.com" >}}
Password: RedHatSNX123!
----


=== Step 2: Log into the Azure Portal

Now let's see what resources we have available currently in our Azure Portal.

To log into the Azure Portal please click link:{azure_portal_url}[here].

[NOTE]
If you are not automatically logged into the Azure portal, please use the Email address and Password above to log in. 

[source,bash]
----
ansible web -m command -a "uptime" -o
----

=== Step 3: Review the setup module

Take a look at your web node's configuration.  The `setup` module displays Ansible facts (and a lot of them) about an endpoint.

[source,bash]
----
ansible web -m setup
----

=== Step 4: Install Maven and Git

Now, let's install Maven & Git using the `package` module.

[source,bash]
----
ansible web -m package -a "name=rh-maven35 state=present" -b
ansible web -m package -a "name=git state=present" -b
----

=== Step 5:Install a group of packages

It is even possible to install groups of packages (aka yum groupinstall); such as Red Hat JBoss Enterprise Application Platform (EAP).


[source,bash]
----
ansible web -m package -a "name=@jboss-eap7 state=present" -b
----

=== Step 6: Start JBoss EAP

JBoss EAP is installed now, so let's start it up using the `service` module.
[source,bash]
----
ansible web -m service -a "name=eap7-standalone state=started" -b
----

=== Step 7: Deploy an application

Next, let's deploy an application.

For simplicity sake, we will use an existing quickstart. To get started, we will checkout some code ...

[source,bash]
----
ansible web -m git -a "repo=https://github.com/jboss-developer/jboss-eap-quickstarts.git dest=/tmp/checkout"
----

and deploy the code via Maven provided by Red Hat Software Collections.
[source,bash]
----
ansible web -m shell -a "scl enable rh-maven35 'mvn clean install wildfly:deploy -Dmaven.test.skip=true' chdir=/tmp/checkout/helloworld" -b
----

Demo site (unit test):
[source,bash]
----
ansible web -m uri -a "url=http://localhost:8080/helloworld/ return_content=yes"
----

Demo site (open this in your web browser):
[source,bash]
----
http://{{< urifqdn_azure "" "node" "" >}}:8080/helloworld/
----

=== Step 8: Cleanup

Finally, let's clean up after ourselves.  First, stop the Red Hat JBoss EAP service, using the following command.

[source,bash]
----
ansible web -m service -a "name=eap7-standalone state=stopped" -b
----

=== Step 9: Remove packages

Next, remove some packages - as follows.

[source,bash]
----
ansible web -m package -a "name=@jboss-eap7 state=absent" -b
ansible web -m package -a "name=eap7-* state=absent" -b
ansible web -m package -a "name=rh-maven35 state=absent" -b
ansible web -m package -a "name=git state=absent" -b
----


====
[NOTE]
Like many Linux commands, `ansible` allows for long-form options as well as short-form.  For example:

----
ansible web --module-name ping
----
is the same as running
----
ansible web -m ping
----
We are going to be using the short-form options throughout this workshop
====

{{< importPartial "footer/footer_azure.html" >}}
